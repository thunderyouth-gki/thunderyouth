<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" type="image/png" href="https://github.com/thunderyouth-gki/thunderyouth/blob/main/logo.png?raw=true">
  <title>Home | Thunder Youth</title>
  <style>
    :root{
      --bg:#F8F8F8;
      --accent:#FFDA56;
      --purple:#4D0FB1;
      --dot:#FDD835;
      --card:#DBCFEF;
      --text:#252424;
      --muted:#666;
      --white:#fff;
      --shadow: 0 4px 10px rgba(0,0,0,0.08);
      --radius: 20px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family: 'Poppins', sans-serif;
      margin:0;
      padding:0;
      background:var(--bg);
      display:flex;
      justify-content:center;
      align-items:flex-start;
      flex-direction:column;
      overflow-y:auto;
      overflow-x:hidden;
      width:100vw;
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Header */
    .header{
      position:sticky;
      top:10px;
      width:100%;
      height:30px;
      margin-top:10px;
      padding:10px 20px;
      background:transparent;
      display:flex;
      align-items:center;
      z-index:100;
    }
    .header img{height:25px;display:block}

    /* Wrapper & slideshow */
    .wrapper{
      position:relative;
      width:100%;
      height:auto;
      display:flex;
      justify-content:center;
      align-items:center;
      overflow:hidden;
      text-align:center;
      margin-top:-50px;
    }

    .masked-slideshow{
      position:relative;
      width:100%;
      aspect-ratio:9/16;
      -webkit-mask-image: url('https://lh3.googleusercontent.com/d/1cOHc0rFmhaL7vpg8zAtzyddawijc5nRr');
      -webkit-mask-size:contain;
      -webkit-mask-repeat:no-repeat;
      -webkit-mask-position:center;
      mask-image: url('https://lh3.googleusercontent.com/d/1cOHc0rFmhaL7vpg8zAtzyddawijc5nRr');
      mask-size:contain;
      mask-repeat:no-repeat;
      mask-position:center;
      overflow:hidden;
      background:transparent;
    }

    .slide{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      background-size:cover;
      background-position:center;
      opacity:0;
      transition:opacity 1.5s ease-in-out;
    }
    .slide.active{opacity:1}

    .purple-overlay{
      position:absolute;
      top:50%;
      left:50%;
      width:100%;
      aspect-ratio:9/16;
      transform:translate(-50%,-50%);
      background:url('https://lh3.googleusercontent.com/d/1cOHc0rFmhaL7vpg8zAtzyddawijc5nRr') no-repeat center;
      background-size:contain;
      opacity:0.7;
      pointer-events:none;
      z-index:10;
    }

    .overlay-text{
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      color:var(--white);
      z-index:20;
      width:100%;
    }
    .overlay-text p{
      font-size:16px;
      margin:20px 0 0;
      color:var(--bg);
    }
    .overlay-text img{
      display:block;
      margin:0 auto 40px;
      width:5em;
      height:5em;
      object-fit:contain;
    }

    /* About */
    .about{
      padding:15px;
      text-align:center;
      background:var(--bg);
      border-radius:var(--radius);
      z-index:20;
      width:100%;
      box-sizing:border-box;
      display:flex;
      justify-content:center;
      align-items:center;
      flex-direction:column;
    }
    .vertical-line{border-left:2px solid #000;height:100px;margin:0 auto}

    /* Information */
    .information{
      width:100%;
      height:auto;
      background:var(--accent);
      padding:40px 0 100px;
      margin-top:-10px;
      text-align:center;
      z-index:0;
      box-sizing:border-box;
    }
    .contact-us{
      display:flex;
      flex-direction:row;
      justify-content:space-around;
      align-items:center;
      padding:20px 20px 0 0;
      margin-top:10px;
      width:100%;
      flex-wrap:wrap;
      overflow-x:hidden;
    }
    .contact-us .icon{display:flex;align-items:center;width:40px;height:40px}
    .contact-us a{color:#333;font-size:24px;text-align:left;float:left}

    .map-container{display:flex;justify-content:center;overflow-x:hidden}
    .map-container iframe{
      width:80%;
      max-width:600px;
      height:220px;
      margin-top:10px;
      border:0;
      border-radius:10px;
      box-shadow:var(--shadow);
    }

    /* Sunday service */
    .sunday-service{
      padding:15px;
      background:var(--bg);
      border-radius:var(--radius);
      z-index:20;
      width:100%;
      box-sizing:border-box;
      margin-top:-20px;
      display:flex;
      justify-content:center;
      align-items:center;
      flex-direction:column;
      margin-bottom:40px;
    }
    .title-sunday-service{text-align:center}

    .event-sunday-service{border-bottom:1px solid #ccc;padding:12px 0;cursor:pointer}
    .summary-sunday-service{
      display:flex;
      justify-content:space-between;
      cursor:pointer;
      user-select:none;
      font-weight:bold;
      font-size:24px;
      padding:0 16px;
      box-sizing:border-box;
    }
    .subtitle-sunday-service{font-size:16px;color:var(--muted);margin-bottom:3px;padding-left:20px}

    .arrow-sunday-service{width:20px;text-align:center;transition:transform .3s ease;padding-right:30px;transform-origin:center top}
    .arrow-sunday-service.rotated{transform:rotate(90deg)}

    .content-sunday-service{
      max-height:0;
      height:auto;
      opacity:0;
      transition:max-height .4s ease,opacity .3s ease;
      font-weight:normal;
      margin-top:8px;
      padding-left:20px;
      overflow:hidden;
    }
    .content-sunday-service.open{opacity:1}

    /* Card */
    .card{width:250px;height:350px;background-color:var(--card);border-radius:20px;text-align:center;align-content:center;margin-top:20px}

    /* Typography */
    h1{font-size:32px;color:var(--purple);margin-bottom:10px}
    h2{font-size:20px;color:var(--text);margin-bottom:10px}
    h3{font-size:16px;color:var(--text);margin-bottom:10px}
    p{font-size:14px;margin-bottom:40px;max-width:600px;margin-left:auto;margin-right:auto;color:var(--text);text-wrap:balance}

    /* Thunderport arc */
    .wrapper-thunderport{height:100vh;width:100%;position:relative;overflow:hidden;touch-action:pan-y}
    .arc-wrapper{
      width:100vw;
      aspect-ratio:1/1;
      background:url("https://lh3.googleusercontent.com/d/1mKXMjp3FRJEBeF-5slEunHmWi1T0_N39") no-repeat center bottom;
      background-size:100% auto;
      position:absolute;
      z-index:1;
    }
    .dot-wrapper{position:absolute;width:100vw;height:auto;margin-top:-40px;top:0;left:0;pointer-events:none;z-index:2}
    .dot{position:absolute;width:30px;height:30px;background-color:var(--dot);border-radius:50%;box-shadow:0 2px 5px rgba(0,0,0,0.2)}

    .content{
      position:absolute;
      top:250px;
      width:100%;
      text-align:center;
      font-size:24px;
      font-weight:bold;
      z-index:3;
      padding:0 20px;
      box-sizing:border-box;
      opacity:1;
      transition:opacity .5s ease;
      user-select:text;
    }
    .fade-in{opacity:0}
    .description{margin-top:10px;font-size:18px;color:var(--text);text-align:justify;width:70%;margin:20px auto}
    .date{margin-top:5px;font-size:14px;color:var(--text)}

    .link-btn{
      margin-top:15px;padding:10px 20px;font-size:16px;font-weight:600;color:var(--white);
      background-color:var(--dot);border:none;border-radius:25px;cursor:pointer;text-decoration:none;display:inline-block;transition:background-color .3s ease;
    }
    .link-btn:hover{background-color:#fbc02d}

    .nav-btn{position:absolute;top:70%;transform:translateY(-50%);background:none;border:none;cursor:pointer;z-index:4;padding:10px}
    .nav-left{left:10px}
    .nav-right{right:10px}
    .arrow-img{width:30px;height:30px;opacity:.8;transition:opacity .2s}
    .nav-btn:hover .arrow-img{opacity:1}
    .hidden{display:none}

    .thunderport-text{position:absolute;width:100vw;top:60px;text-align:center;z-index:10;pointer-events:none;user-select:none}
    .big-text{font-size:32px;font-weight:bold;color:var(--bg);margin-bottom:4px}
    .small-text{font-size:20px;font-weight:400;color:var(--bg)}

    /* Footer */
    .footer{
      display:flex;
      justify-content:space-around;
      align-items:center;
      position:fixed;
      bottom:0;
      width:100%;
      background-color:var(--bg);
      padding:5px 0;
      box-shadow:0 -2px 5px rgba(0,0,0,0.1);
      border-radius:20px 20px 0 0;
      transition:transform .3s ease-in-out;
      z-index:1000;
    }
    .footer-item{text-align:center;cursor:pointer}
    .footer-item img{width:30px;height:30px;margin-top:5px}
    .footer-item span{display:block;font-size:12px;margin-top:0}

    @media (max-width:600px){
      .content{font-size:20px}
      .description{font-size:16px;width:90%}
      .link-btn{font-size:14px;padding:8px 16px}
      .overlay-text p{font-size:14px}
      .overlay-text img{width:4.2em;height:4.2em;margin-bottom:28px}
    }
  </style>
</head>
<body>
  <div class="header">
    <img src="https://lh3.googleusercontent.com/d/1VikC7CxegmubJZ1paeu4NXSS8W9Dgpf2" alt="Logo">
  </div>

  <div class="wrapper">
    <div class="masked-slideshow" id="slideshow"></div>
    <div class="purple-overlay"></div>
    <div class="overlay-text">
      <img src="https://lh3.googleusercontent.com/d/1ludWWFm6w2Rr8leLIk2n2_Nm4EuKaezL" alt="Logo">
      <p><i>Sailing together in Faith</i> <br> <i>Guided by His Grace</i></p>
    </div>
  </div>

  <section class="about">
    <h1>Thunder Youth</h1>
    <p>Welcome to Thunder Youth, the vibrant youth community of GKI Guntur in beautiful Bandung! We are a place where young people come together to grow in faith, build genuine friendships, and live out God's love in everyday life.</p>

    <div class="vertical-line"></div>

    <h2 style="margin-top: 50px;">VISION</h2>
    <p>To become God’s fellow companion among the youth.</p>

    <h2>MISSION</h2>
    <p>To build a community of youth strengthened by faith and love.</p>
  </section>

  <section class="information">
    <h1>Connect With Us</h1>

    <div class="contact-us">
      <div class="icon">
        <a href="https://www.instagram.com/thunderyouth.13/" target="_blank" title="Instagram">
          <img src="https://cdn-icons-png.flaticon.com/512/1384/1384063.png" alt="Instagram Icon" width="40" height="40">
        </a>
      </div>
      <div class="icon">
        <a href="https://chat.whatsapp.com/HnwLObchlez4VxTJnIp7pS" target="_blank" title="Whatsapp">
          <img src="https://cdn-icons-png.flaticon.com/512/2111/2111728.png" alt="Whatsapp Icon" width="40" height="40">
        </a>
      </div>
      <div class="icon">
        <a href="https://www.youtube.com/@gkiguntur3814" target="_blank" title="YouTube">
          <img src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png" alt="YouTube Icon" width="40" height="40">
        </a>
      </div>
    </div>

    <h1>Our Church</h1>
    <h3>GKI Guntur<br>Jalan Guntur No.13, Bandung</h3>

    <div class="map-container">
      <iframe
        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d15842.828094517385!2d107.6222962976227!3d-6.925581826717491!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e68e7d4d54aece3%3A0x6c376128d1fe429!2sGereja%20Kristen%20Indonesia%20Guntur!5e0!3m2!1sen!2sid!4v1745668780661!5m2!1sen!2sid"
        allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
    </div>
  </section>

  <section class="sunday-service">
    <div class="title-sunday-service">
      <h1>Sunday Service</h1>
      <h3>Every Sunday, 09.30 WIB</h3>
    </div>

    <div class="event-sunday-service">
      <div class="subtitle-sunday-service">First week of the month</div>
      <div class="summary-sunday-service">
        <div>BACK TO THE BIBLE</div>
        <div class="arrow-sunday-service">&#9656;</div>
      </div>
      <div class="content-sunday-service">
        Thunder Youth mau mengajak kamu untuk kembali membudayakan membaca Firman Tuhan dari Alkitab fisik.
        Buat kamu yang minggu ini belum bawa Alkitab fisik, boleh pinjem ke usher di depan ya. Jangan lupa untuk bawa Alkitab bulan depan!
        <br><br>
        <strong>What To Prepare</strong>
        <br>&#9656; Baca <strong>Chapter of the Week</strong> yang dibagikan di story instagram <a href="https://www.instagram.com/thunderyouth.13/">thunderyouth.13</a>
        <br>&#9656; Bawa Alkitab TB 2 ke kebaktian minggu
      </div>
    </div>

    <div class="event-sunday-service">
      <div class="subtitle-sunday-service">Second week of the month</div>
      <div class="summary-sunday-service">
        <div>SUNDAY SHARING</div>
        <div class="arrow-sunday-service">&#9656;</div>
      </div>
      <div class="content-sunday-service">
        Setiap orang pasti punya keluh kesah. Tapi jangan khawatir, selama kita berjalan bersama Tuhan Yesus semua perkara pasti bisa dihadapi.
        Setelah mendengar Firman Tuhan nanti Thunders diajak untuk merenungkan bersama dan merefleksikan Firman-Nya dalam kehidupan kita.
        <br> <br>
        <strong>What To Prepare</strong>
        <br>&#9656; Yuk gali lagi cerita menarik apa dalam hidupmu yang terjadi akhir-akhir ini
      </div>
    </div>

    <div class="event-sunday-service">
      <div class="subtitle-sunday-service">Third week of the month</div>
      <div class="summary-sunday-service">
        <div>THUNDER LOUNGE</div>
        <div class="arrow-sunday-service">&#9656;</div>
      </div>
      <div class="content-sunday-service">
        Saatnya ngopi bersama Thunder! Setelah kebaktian jangan langsung pulang ya! Mari berkumpul bersama di Thunder Lounge.
        Ada kopi, ada snack, ada board game, kurang apa? kurang kamu!
        <br> <br>
        <strong>What To Prepare</strong>
        <br>&#9656; Waktu kamu setelah kebaktian nanti!
      </div>
    </div>

    <div class="event-sunday-service">
      <div class="subtitle-sunday-service">Fourth week of the month</div>
      <div class="summary-sunday-service">
        <div>CELEBRATION WEEK</div>
        <div class="arrow-sunday-service">&#9656;</div>
      </div>
      <div class="content-sunday-service">
        A month full of blessings! Yuk kita flashback lagi satu bulan ini Tuhan udah ngasih apa aja buat kita.
        Mari bagikan rasa syukur dengan menceritakannya di form yang disediakan. Jangan sungkan untuk berbagi kebahagiaanmu ya Thunders!
        <br> <br>
        <strong>What To Prepare</strong>
        <br>&#9656; Nothing! just enjoy the feast!
      </div>
    </div>
  </section>

  <div class="wrapper-thunderport" id="swipe-area" tabindex="0" aria-label="Arc Dot Navigator" role="region" aria-live="polite">
    <div class="arc-wrapper" role="presentation"></div>
    <div class="thunderport-text">
      <div class="big-text">Thunderport</div>
      <div class="small-text">Thunder Youth Fellowship</div>
    </div>

    <div class="dot-wrapper"><div class="dot" id="dot"></div></div>

    <div class="content" id="content">
      <div class="title"></div>
      <div class="date"></div>
      <div class="description"></div>
      <a href="#" class="link-btn hidden" target="_blank" rel="noopener noreferrer">Read More</a>
    </div>

    <button class="nav-btn nav-left" id="leftBtn" aria-label="Previous">
      <img src="https://img.icons8.com/ios-filled/50/888888/chevron-left.png" alt="Previous" class="arrow-img" />
    </button>
    <button class="nav-btn nav-right" id="rightBtn" aria-label="Next">
      <img src="https://img.icons8.com/ios-filled/50/888888/chevron-right.png" alt="Next" class="arrow-img" />
    </button>
  </div>

  <div class="footer" id="footer">
    <div class="footer-item">
      <img src="https://lh3.googleusercontent.com/d/1Ls9Ci-xvgXQZePWs-33468b0EUQz0pxd"
           data-default="https://lh3.googleusercontent.com/d/1M1axLb9BnoWun9iDPcAx_ZUID5ZlEl_m"
           data-active="https://lh3.googleusercontent.com/d/1Ls9Ci-xvgXQZePWs-33468b0EUQz0pxd"
           alt="Home">
      <span>Home</span>
    </div>
    <div class="footer-item" onclick="toggleIcon(this)">
      <a href='https://thunderyouth.gkiguntur.com/warta'>
      <img src="https://lh3.googleusercontent.com/d/1WMPNZl0Lc724pDDoC4lsWQtbkP3h6yUD"
           data-default="https://lh3.googleusercontent.com/d/1WMPNZl0Lc724pDDoC4lsWQtbkP3h6yUD"
           data-active="https://lh3.googleusercontent.com/d/1WIGRe_Ba07hCyw5N1fetmm7i5yjHx8S9"
           alt="History">
      <span>Warta</span>
      </a>
    </div>
    <div class="footer-item" onclick="toggleIcon(this)">
      <a href='https://thunderyouth.gkiguntur.com/history'>
      <img src="https://lh3.googleusercontent.com/d/1MF2aumWkfIvGKqsg_P84G2iv8agK5nyy"
           data-default="https://lh3.googleusercontent.com/d/1MF2aumWkfIvGKqsg_P84G2iv8agK5nyy"
           data-active="https://lh3.googleusercontent.com/d/1LydGXt7w6IyiRWfP7Hdi8YfpBWBqxdHp"
           alt="History">
      <span>History</span>
      </a>
    </div>
    <div class="footer-item" onclick="toggleIcon(this)">
      <a href='https://thunderyouth.gkiguntur.com/profile'>
      <img src="https://lh3.googleusercontent.com/d/1M8uxpiXhKUmu2WMR6_iR1RraErskHuZ9"
           data-default="https://lh3.googleusercontent.com/d/1M8uxpiXhKUmu2WMR6_iR1RraErskHuZ9"
           data-active="https://lh3.googleusercontent.com/d/1Lt3K_ZqPYJUT2iv1mLyTBpvtuMuhxWOA"
           alt="Profile">
      <span>Profile</span>
      </a>
    </div>
  </div>

  <script>
    (function () {
      'use strict';

      const scriptURL = "https://script.google.com/macros/s/AKfycbwMZAEMfeT-GIZgcvOWi8Kw0kpo7OZEpBb-gPHhXvDDtYfFqeyzuCDRdS2-PUReZzO0/exec?page=Home";
      let data = [];

      // helpers
      const $ = (sel) => document.querySelector(sel);
      const $$ = (sel) => Array.from(document.querySelectorAll(sel));

      // DOM refs (guard inits)
      const slideshowContainer = $('#slideshow');
      const dot = $('#dot');
      const content = $('#content');
      const titleEl = content?.querySelector('.title');
      const descEl = content?.querySelector('.description');
      const dateEl = content?.querySelector('.date');
      const linkBtn = content?.querySelector('.link-btn');
      const leftBtn = $('#leftBtn');
      const rightBtn = $('#rightBtn');
      const swipeArea = $('#swipe-area');

      // load data & render slideshow
      async function loadData() {
        try {
          const res = await fetch(scriptURL);
          const json = await res.json();

          // slideshow
          const slideshow = Array.isArray(json.slideshow) ? json.slideshow : [];
          if (slideshowContainer) {
            slideshowContainer.innerHTML = '';
            slideshow.forEach((url, i) => {
              const div = document.createElement('div');
              div.className = 'slide' + (i === 0 ? ' active' : '');
              div.style.backgroundImage = `url('${url}')`;
              slideshowContainer.appendChild(div);
            });
          }

          // start slideshow interval only if more than 1 slide
          const slides = slideshowContainer ? slideshowContainer.querySelectorAll('.slide') : [];
          if (slides && slides.length > 1) {
            let sIndex = 0;
            setInterval(() => {
              const nodeList = slideshowContainer.querySelectorAll('.slide');
              if (!nodeList || nodeList.length === 0) return;
              nodeList[sIndex]?.classList.remove('active');
              sIndex = (sIndex + 1) % nodeList.length;
              nodeList[sIndex]?.classList.add('active');
            }, 4000);
          }

          // thunderport data
          data = Array.isArray(json.thunderport) ? json.thunderport : [];
          initUI();
        } catch (err) {
          // keep console for debugging
          console.error('Fetch failed', err);
        }
      }

      // Sunday service expand/collapse
      document.addEventListener('DOMContentLoaded', () => {
        const events = $$('.event-sunday-service');
        events.forEach(event => {
          const contentEl = event.querySelector('.content-sunday-service');
          const arrow = event.querySelector('.arrow-sunday-service');

          event.addEventListener('click', () => {
            const isOpen = contentEl.classList.contains('open');
            // close others
            events.forEach(ev => {
              const c = ev.querySelector('.content-sunday-service');
              const a = ev.querySelector('.arrow-sunday-service');
              if (c) {
                c.classList.remove('open');
                c.style.maxHeight = null;
              }
              if (a) a.classList.remove('rotated');
            });

            // toggle clicked
            if (!isOpen) {
              contentEl.classList.add('open');
              contentEl.style.maxHeight = contentEl.scrollHeight + 'px';
              if (arrow) arrow.classList.add('rotated');
            }
          });
        });
      });

      // Arc & dot navigator
      let currentIndex = 0;
      const arcStart = 200;
      const arcEnd = 340;

      function getCenterAndRadius() {
        const width = window.innerWidth;
        const radius = width / 2;
        const x = width / 2;
        const y = width;
        return { x, y, radius };
      }

      function setDotPosition(index) {
        if (!dot || !data || data.length === 0) return;
        const steps = Math.max(1, data.length - 1);
        const angleDeg = arcStart + ((arcEnd - arcStart) / steps) * index;
        const angleRad = angleDeg * Math.PI / 180;
        const { x: cx, y: cy, radius } = getCenterAndRadius();
        const x = cx + radius * Math.cos(angleRad);
        const y = cy + radius * Math.sin(angleRad);
        dot.style.left = `${x - 15}px`;
        dot.style.top = `${y - 15}px`;
      }

      function easeInOutQuad(t) {
        return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;
      }

      function animateArc(fromIndex, toIndex, callback) {
        if (!dot || !data || data.length === 0) { if (callback) callback(); return; }
        const duration = 400;
        let start = null;

        function step(timestamp) {
          if (!start) start = timestamp;
          const progress = Math.min((timestamp - start) / duration, 1);
          const eased = easeInOutQuad(progress);
          const steps = Math.max(1, data.length - 1);
          const angleFrom = arcStart + ((arcEnd - arcStart) / steps) * fromIndex;
          const angleTo = arcStart + ((arcEnd - arcStart) / steps) * toIndex;
          const currentAngle = angleFrom + (angleTo - angleFrom) * eased;

          const angleRad = currentAngle * Math.PI / 180;
          const { x: cx, y: cy, radius } = getCenterAndRadius();
          const x = cx + radius * Math.cos(angleRad);
          const y = cy + radius * Math.sin(angleRad);
          dot.style.left = `${x - 15}px`;
          dot.style.top = `${y - 15}px`;

          if (progress < 1) {
            requestAnimationFrame(step);
          } else if (callback) {
            callback();
          }
        }

        requestAnimationFrame(step);
      }

      function updateUI(nextIndex) {
        if (!data || nextIndex < 0 || nextIndex >= data.length) return;
        if (content) content.classList.add('fade-in');
        animateArc(currentIndex, nextIndex, () => {
          currentIndex = nextIndex;
          const d = data[currentIndex] || {};
          if (titleEl) titleEl.textContent = d.title || '';
          if (descEl) descEl.textContent = d.description || '';
          if (dateEl) dateEl.textContent = d.date || '';
          if (linkBtn) {
            if (d.link && d.link.trim() !== '') {
              linkBtn.href = d.link;
              linkBtn.classList.remove('hidden');
            } else {
              linkBtn.href = '#';
              linkBtn.classList.add('hidden');
            }
          }
          updateButtons();
          setTimeout(() => {
            if (content) content.classList.remove('fade-in');
          }, 50);
        });
      }

      function updateButtons() {
        if (!leftBtn || !rightBtn) return;
        leftBtn.classList.toggle('hidden', currentIndex === 0);
        rightBtn.classList.toggle('hidden', currentIndex === data.length - 1);
      }

      function initUI() {
        if (!data || data.length === 0) return;
        setDotPosition(currentIndex);
        const d = data[currentIndex] || {};
        if (titleEl) titleEl.textContent = d.title || '';
        if (descEl) descEl.textContent = d.description || '';
        if (dateEl) dateEl.textContent = d.date || '';
        if (linkBtn) {
          if (d.link && d.link.trim() !== '') {
            linkBtn.href = d.link;
            linkBtn.classList.remove('hidden');
          } else {
            linkBtn.href = '#';
            linkBtn.classList.add('hidden');
          }
        }
        updateButtons();
      }

      // events
      window.addEventListener('resize', () => setDotPosition(currentIndex));
      window.addEventListener('DOMContentLoaded', initUI);

      leftBtn?.addEventListener('click', () => { if (currentIndex > 0) updateUI(currentIndex - 1); });
      rightBtn?.addEventListener('click', () => { if (currentIndex < data.length - 1) updateUI(currentIndex + 1); });

      // swipe support
      let touchStartX = null, touchStartY = null, touchEndX = null, touchEndY = null;
      swipeArea?.addEventListener('touchstart', (e) => {
        if (e.touches.length === 1) {
          touchStartX = e.touches[0].clientX;
          touchStartY = e.touches[0].clientY;
        }
      });

      swipeArea?.addEventListener('touchmove', (e) => {
        if (!touchStartX) return;
        const moveX = e.touches[0].clientX;
        const moveY = e.touches[0].clientY;
        const dx = moveX - touchStartX;
        const dy = moveY - touchStartY;
        if (Math.abs(dx) > Math.abs(dy)) e.preventDefault();
      }, { passive: false });

      swipeArea?.addEventListener('touchend', (e) => {
        if (touchStartX === null) return;
        touchEndX = e.changedTouches[0].clientX;
        touchEndY = e.changedTouches[0].clientY;
        const dx = touchEndX - touchStartX;
        const dy = touchEndY - touchStartY;
        if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 30) {
          if (dx > 0 && currentIndex > 0) updateUI(currentIndex - 1);
          else if (dx < 0 && currentIndex < data.length - 1) updateUI(currentIndex + 1);
        }
        touchStartX = touchStartY = touchEndX = touchEndY = null;
      });

      swipeArea?.addEventListener('keydown', (e) => {
        if (e.key === "ArrowLeft" && currentIndex > 0) updateUI(currentIndex - 1);
        else if (e.key === "ArrowRight" && currentIndex < data.length - 1) updateUI(currentIndex + 1);
      });

      // small utility: toggle footer icon src (keeps data attributes)
      window.toggleIcon = function (el) {
        try {
          const img = el.querySelector('img');
          if (!img) return;
          const active = img.getAttribute('data-active');
          const def = img.getAttribute('data-default');
          const isActive = img.src === active;
          img.src = isActive ? def || img.src : active || img.src;
        } catch (e) {
          console.error(e);
        }
      };

      // start
      loadData();
    })();
  </script>
</body>
</html>
